C51 COMPILER V9.05   MAIN                                                                  06/15/2016 22:42:16 PAGE 1   


C51 COMPILER V9.05, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          
   2          #include "STC12C5A60S2.h"
   3          #include "intrins.h" 
   4          #include "stdio.h"
   5          #include"uart.h"
   6          
   7          #define uchar unsigned char
   8          #define uint unsigned int
   9          
  10          sbit OUT1   =  P4^2;            //输出IO口1，    激光1
  11          sbit OUT2   =  P1^0;        //输出2，        激光2
  12          sbit OUT3   =  P1^1;            //输出3，        激光3
  13          sbit OUT4   =  P1^2;        //输出4，        激光4
  14          sbit OUT5   =  P1^3;        //输出5，        激光5
  15          sbit OUT6   =  P1^4;            //输出6，        激光6
  16          sbit OUT7   =  P1^5;            //输出7，        激光7
  17          sbit OUT8   =  P1^6;            //输出8，        R4电磁锁 最终逃生门
  18          sbit OUT9   =  P1^7;            //输出9，        
  19          sbit OUT10  =  P4^3;            //输出10，       
  20          
  21          
  22          
  23          sbit M10     =  P3^2;            //电缸1+                     
  24          sbit M11     =  P3^3;            //电缸1-
  25          sbit M20     =  P3^4;            //电缸2+
  26          sbit M21     =  P3^5;            //电缸2-
  27          sbit M30     =  P3^6;            //电缸3+
  28          sbit M31     =  P3^7;            //电缸3-
  29          
  30          sbit OUT21   =  P4^0;           //输出IO控制口21   激光接收部分灯带1
  31          sbit OUT22   =  P2^0;       //输出22               灯带2
  32          sbit OUT23   =  P2^1;           //输出23                   灯带3
  33          sbit OUT24   =  P2^2;       //输出24               灯带4
  34          sbit OUT25   =  P2^3;       //输出25               灯带5
  35          sbit OUT26   =  P2^4;           //输出26                   灯带6
  36          sbit OUT27   =  P2^5;           //输出27
  37          
  38          sbit OUT28   =  P2^6;       //                             第七把剑
  39          sbit OUT29   =  P2^7;           //                                 金属接近7
  40          
  41          sbit INPUT16   =  P4^4;         //输入IO控制口16，  激光接收1
  42          sbit INPUT15   =  P4^5;     //输入15，          激光接收2 
  43          sbit INPUT14   =  P4^1;         //输入14                        激光接收3
  44          sbit INPUT13   =  P4^6;     //输入13                    激光接收4 
  45          sbit INPUT12   =  P0^7;     //输入12                    激光接收5 
  46          sbit INPUT11   =  P0^6;         //输入11，按键类型      激光接收6 
  47          
  48          sbit INPUT10   =  P0^5;         //输入10，门禁类型       金属接近1
  49          sbit INPUT9    =  P0^4;         //输入9，门禁            金属接近2
  50          sbit INPUT8    =  P0^3;         //输入8，门禁            金属接近3
  51          sbit INPUT7    =  P0^2;         //输入7，门禁            金属接近4
  52          sbit INPUT6    =  P0^1;         //输入6，门禁            金属接近5
  53          sbit INPUT5    =  P0^0;     //输入5，门禁类型    金属接近6
  54          
  55          sbit RXD   =  P3^0;         
C51 COMPILER V9.05   MAIN                                                                  06/15/2016 22:42:16 PAGE 2   

  56          sbit TXD   =  P3^1;
  57          
  58          #define uchar unsigned char
  59          #define uint unsigned int
  60          
  61          sfr P4sw=0xbb;
  62          
  63          void sys_init(void);
  64          void delay_ms(int count);
  65          void mp3_init();
  66          void mp3(unsigned char comd);
  67          
  68          unsigned char Game_Start=0,laser1=0,laser2=0,laser3=0,laser4=0,laser5=0,laser6=0,i1=0,i2=0,i3=0,i4=0,k=0,c
             -ount=0,count_step1=0,count_step2=0,count_step3=0;
  69          unsigned char flag_step1=0,flag_step2=0,flag_step3=0,flag_step4=0,flag_step5=0,flag_step6=0,flag_step7=0,f
             -lag_step8=0,flag_step9=0,flag_step10=0,flag_step11=0;
  70          
  71          
  72          
  73          /************************************************************************
  74              函数名称：   void main(void)                
  75              函数功能：   
  76              调用函数：  void delay(unsigned int loop_time)      
  77          *************************************************************************/
  78          void main()
  79          {
  80   1              sys_init();             
  81   1              P4sw = 0x70;
  82   1      
  83   1              while(1)
  84   1                {                                     
  85   2                               if((INPUT10==0)&&(flag_step2==0))
  86   2                               {
  87   3                                      delay_ms(100);
  88   3                                      mp3(0x33);
  89   3                                      mp3(0x01);
  90   3                                  delay_ms(500);
  91   3                                      flag_step2=1;
  92   3                               }
  93   2                               if((INPUT9==0)&&(flag_step3==0))
  94   2                               {
  95   3                                      delay_ms(100);
  96   3                                      mp3(0x33);
  97   3                                      mp3(0x02);
  98   3                                      delay_ms(500);
  99   3                                      flag_step3=1;
 100   3                               }
 101   2                               if((INPUT8==0)&&(flag_step4==0))
 102   2                               {
 103   3                                      delay_ms(100);
 104   3                                      mp3(0x33);
 105   3                                      mp3(0x03);
 106   3                                      delay_ms(500);
 107   3                                      flag_step4=1;
 108   3                               }
 109   2                               if((INPUT7==0)&&(flag_step5==0))
 110   2                               {
 111   3                                      delay_ms(100);
 112   3                                      mp3(0x33);
 113   3                                      mp3(0x04);
 114   3                                      delay_ms(500);
 115   3                                      flag_step5=1;
C51 COMPILER V9.05   MAIN                                                                  06/15/2016 22:42:16 PAGE 3   

 116   3                               }
 117   2                               if((INPUT6==0)&&(flag_step6==0))
 118   2                               {
 119   3                                      delay_ms(100);
 120   3                                      mp3(0x33);
 121   3                                      mp3(0x05);
 122   3                                      delay_ms(500);
 123   3                                      flag_step6=1;
 124   3                               }
 125   2                               if((INPUT5==0)&&(flag_step7==0))
 126   2                               {
 127   3                                      delay_ms(100);
 128   3                                      mp3(0x33);
 129   3                                      mp3(0x06);
 130   3                                      delay_ms(500);
 131   3                                      flag_step7=1;
 132   3                               }
 133   2                               if((OUT28==0)&&(flag_step8==0))
 134   2                               {
 135   3                                      delay_ms(100);
 136   3                                      mp3(0x33);
 137   3                                      mp3(0x07);
 138   3                                      delay_ms(500);
 139   3                                      flag_step8=1;
 140   3                               }
 141   2      
 142   2                               if((flag_step2 == 1) && (flag_step3 == 1) && (flag_step4 == 1) && (flag_step5 == 1)&& (flag_step6 == 1
             -) && (flag_step7 == 1) && (flag_step8 == 1) &&(flag_step1==0))
 143   2                      //       if((INPUT10==0)&&(INPUT9==0)&&(INPUT8==0)&&(INPUT7==0)&&(INPUT6==0)&&(INPUT5==0)&&(flag_step1==0))      
             - //全部的剑插入剑槽中
 144   2                               {
 145   3                                      mp3(0x33);
 146   3                                      mp3(0x08);                         //剑阵启动
 147   3                              
 148   3                                      OUT1=1;
 149   3                                      delay_ms(500);
 150   3                                      OUT2=1;
 151   3                                      delay_ms(500);
 152   3                                      OUT3=1;
 153   3                                      delay_ms(500);
 154   3                                      OUT4=1;
 155   3                                      delay_ms(500);
 156   3                                      OUT5=1;
 157   3                                      delay_ms(500);
 158   3                                      OUT6=1;
 159   3                                      delay_ms(500);
 160   3                                      OUT7=1;
 161   3      
 162   3                                      flag_step1=1;           
 163   3                                      delay_ms(5000);
 164   3                                      OUT21=0;                           //打开六芒星灯带
 165   3                                      OUT22=0;
 166   3                                      OUT23=0;
 167   3                                      OUT24=0;
 168   3                                      OUT25=0;
 169   3                                      OUT26=0;
 170   3                                      OUT1=0;
 171   3                                      OUT2=0;
 172   3                                      OUT3=0;
 173   3                                      OUT4=0;
 174   3                                      OUT5=0;
 175   3                                      OUT6=0;
C51 COMPILER V9.05   MAIN                                                                  06/15/2016 22:42:16 PAGE 4   

 176   3                                      OUT7=0;
 177   3                                      delay_ms(5000); 
 178   3      
 179   3                              //      OUT21=1;
 180   3                              //      OUT1=1;
 181   3                              //      while(!INPUT16);
 182   3                              //      OUT21=0;
 183   3                      //              OUT1=0;
 184   3                                      OUT2=1;
 185   3                                      OUT3=1;
 186   3                                      OUT22=1;
 187   3                                      while(!INPUT15);
 188   3                                      OUT22=0;
 189   3                                                      OUT2=0;
 190   3                                                      OUT3=0;
 191   3                                                      OUT4=1;
 192   3                                                      OUT5=1;
 193   3                                      OUT23=1;
 194   3                                      while(!INPUT14);
 195   3                                      OUT23=0;
 196   3                                                      OUT4=0;
 197   3                                                      OUT5=0;
 198   3                                                      OUT7=1;
 199   3                                                      OUT2=1;
 200   3                                      OUT24=1;
 201   3                                      while(!INPUT13);
 202   3                                      OUT24=0;
 203   3                                                      OUT7=0;
 204   3                                                      OUT2=0;
 205   3                                                      OUT6=1;
 206   3                                      OUT25=1;
 207   3                                      while(!INPUT12);
 208   3                                      OUT25=0;
 209   3                                              OUT6=0;
 210   3                                                      OUT3=1;
 211   3                                                      OUT5=1;
 212   3                                      OUT26=1;
 213   3                                      while(!INPUT11);
 214   3                                      OUT26=0;
 215   3                                              OUT3=0;
 216   3                                                      OUT5=0;
 217   3                                                               
 218   3                               }
 219   2                              
 220   2                         while((count_step1==0)&&(flag_step1==1))
 221   2                         {
 222   3                                if(flag_step11==0)
 223   3                                {
 224   4      
 225   4                                              OUT24=1;
 226   4                                              OUT2=1;
 227   4                                              OUT3=1;
 228   4                                              for(i1=0;i1<80;i1++)
 229   4                                              {
 230   5                                                if(INPUT13==1)
 231   5                                                {
 232   6                                                  delay_ms(50);
 233   6                                                      if(INPUT13==1)
 234   6                                                      {
 235   7                                                         count++;
 236   7                                                         OUT24=0;
 237   7                                                      }
C51 COMPILER V9.05   MAIN                                                                  06/15/2016 22:42:16 PAGE 5   

 238   6                                                }
 239   5                                                delay_ms(100);
 240   5                                              }
 241   4                                              OUT24=0;
 242   4                                              OUT2=0;
 243   4                                              OUT3=0;                         
 244   4                                                      delay_ms(500);
 245   4      
 246   4                                              OUT24=1;
 247   4                                              OUT26=1;
 248   4                                              OUT2=1;
 249   4                                              OUT3=1;
 250   4                                              OUT5=1;
 251   4                                              for(i1=0;i1<80;i1++)
 252   4                                              {
 253   5                                                if(INPUT13==1)
 254   5                                                {
 255   6                                                  delay_ms(50);
 256   6                                                      if(INPUT13==1)
 257   6                                                      {
 258   7                                                         count++;
 259   7                                                         OUT24=0;
 260   7                                                      }
 261   6                                                }
 262   5                                                if(INPUT11==1)
 263   5                                                {
 264   6                                                  delay_ms(50);
 265   6                                                      if(INPUT11==1)
 266   6                                                      {
 267   7                                                         count++;
 268   7                                                         OUT26=0;
 269   7                                                      }
 270   6                                                }
 271   5                                                delay_ms(100);
 272   5                                              }
 273   4                                              OUT24=0;
 274   4                                              OUT26=0;
 275   4                                              OUT2=0;
 276   4                                              OUT3=0;
 277   4                                              OUT5=0;
 278   4                                              delay_ms(500);
 279   4      
 280   4                                              OUT22=1;
 281   4                                              OUT25=1;
 282   4                                              OUT1=1;
 283   4                                              OUT4=1;
 284   4                                              OUT7=1;
 285   4                                              for(i1=0;i1<80;i1++)
 286   4                                              {
 287   5                                                if(INPUT15==1)
 288   5                                                {
 289   6                                                  delay_ms(50);
 290   6                                                      if(INPUT15==1)
 291   6                                                      {
 292   7                                                         count++;
 293   7                                                         OUT22=0;
 294   7                                                      }
 295   6                                                }
 296   5                                                if(INPUT12==1)
 297   5                                                {
 298   6                                                  delay_ms(50);
 299   6                                                      if(INPUT12==1)
C51 COMPILER V9.05   MAIN                                                                  06/15/2016 22:42:16 PAGE 6   

 300   6                                                      {
 301   7                                                         count++;
 302   7                                                         OUT25=0;
 303   7                                                      }
 304   6                                                }
 305   5                                                delay_ms(100);
 306   5                                              }
 307   4                                              OUT22=0;
 308   4                                              OUT25=0;
 309   4                                              OUT1=0;
 310   4                                              OUT4=0;
 311   4                                              OUT7=0;
 312   4                                              delay_ms(500);
 313   4                                              OUT23=1;
 314   4                                              OUT24=1;
 315   4                                              OUT25=1;
 316   4                                              OUT1=1;
 317   4                                              OUT2=1;
 318   4                                              OUT4=1;
 319   4                                              OUT6=1;
 320   4      
 321   4                                              for(i1=0;i1<120;i1++)
 322   4                                              {
 323   5                                                if(INPUT14==1)
 324   5                                                {
 325   6                                                  delay_ms(50);
 326   6                                                      if(INPUT14==1)
 327   6                                                      {
 328   7                                                         count++;
 329   7                                                         OUT23=0;
 330   7                                                      }
 331   6                                                }
 332   5                                                if(INPUT13==1)
 333   5                                                {
 334   6                                                  delay_ms(50);
 335   6                                                      if(INPUT13==1)
 336   6                                                      {
 337   7                                                         count++;
 338   7                                                         OUT24=0;
 339   7                                                      }
 340   6                                                }
 341   5                                                if(INPUT12==1)
 342   5                                                {
 343   6                                                  delay_ms(50);
 344   6                                                      if(INPUT12==1)
 345   6                                                      {
 346   7                                                         count++;
 347   7                                                         OUT25=0;
 348   7                                                      }
 349   6                                                }
 350   5                                                delay_ms(100);
 351   5                                              }
 352   4                                              OUT23=0;
 353   4                                              OUT24=0;
 354   4                                              OUT25=0;
 355   4                                              OUT1=0;
 356   4                                              OUT2=0;
 357   4                                              OUT4=0;
 358   4                                              OUT6=0;
 359   4                                              delay_ms(500);
 360   4                                              OUT22=1;
 361   4                                              OUT23=1;
C51 COMPILER V9.05   MAIN                                                                  06/15/2016 22:42:16 PAGE 7   

 362   4                                              OUT26=1;
 363   4                                              OUT2=1;
 364   4                                              OUT4=1;
 365   4                                              OUT5=1;
 366   4                                              OUT7=1;
 367   4                                              for(i1=0;i1<120;i1++)
 368   4                                              {
 369   5                                                if(INPUT15==1)
 370   5                                                {
 371   6                                                  delay_ms(50);
 372   6                                                      if(INPUT15==1)
 373   6                                                      {
 374   7                                                         count++;
 375   7                                                         OUT22=0;
 376   7                                                      }
 377   6                                                }
 378   5                                                if(INPUT14==1)
 379   5                                                {
 380   6                                                  delay_ms(50);
 381   6                                                      if(INPUT14==1)
 382   6                                                      {
 383   7                                                         count++;
 384   7                                                         OUT23=0;
 385   7                                                      }
 386   6                                                }
 387   5                                                if(INPUT11==1)
 388   5                                                {
 389   6                                                  delay_ms(50);
 390   6                                                      if(INPUT11==1)
 391   6                                                      {
 392   7                                                         count++;
 393   7                                                         OUT26=0;
 394   7                                                      }
 395   6                                                }
 396   5                                                delay_ms(100);
 397   5                                              }
 398   4      
 399   4                                          OUT22=0;
 400   4                                              OUT23=0;
 401   4                                              OUT26=0;
 402   4                                              OUT2=0;
 403   4                                              OUT4=0;
 404   4                                              OUT5=0;
 405   4                                              OUT7=0;
 406   4      
 407   4                                              OUT22=1;
 408   4                                              OUT24=1;
 409   4                                              OUT25=1;
 410   4                                              OUT1=1;
 411   4                                              OUT2=1;
 412   4                                              OUT3=1;
 413   4                                              OUT6=1;
 414   4                                              OUT7=1;
 415   4                                              for(i1=0;i1<150;i1++)
 416   4                                              {
 417   5                                                if(INPUT16==1)
 418   5                                                {
 419   6                                                  delay_ms(50);
 420   6                                                      if(INPUT16==1)
 421   6                                                      {
 422   7                                                         count++;
 423   7                                                         OUT21=0;
C51 COMPILER V9.05   MAIN                                                                  06/15/2016 22:42:16 PAGE 8   

 424   7                                                      }
 425   6                                                }
 426   5                                                if(INPUT15==1)
 427   5                                                {
 428   6                                                  delay_ms(50);
 429   6                                                      if(INPUT15==1)
 430   6                                                      {
 431   7                                                         count++;
 432   7                                                         OUT22=0;
 433   7                                                      }
 434   6                                                }
 435   5                                                if(INPUT13==1)
 436   5                                                {
 437   6                                                  delay_ms(50);
 438   6                                                      if(INPUT13==1)
 439   6                                                      {
 440   7                                                         count++;
 441   7                                                         OUT24=0;
 442   7                                                      }
 443   6                                                }
 444   5                                                if(INPUT12==1)
 445   5                                                {
 446   6                                                  delay_ms(50);
 447   6                                                      if(INPUT12==1)
 448   6                                                      {
 449   7                                                         count++;
 450   7                                                         OUT25=0;
 451   7                                                      }
 452   6                                                }
 453   5                                                delay_ms(100);
 454   5                                              }
 455   4      
 456   4                                          OUT21=0;
 457   4                                              OUT22=0;
 458   4                                              OUT24=0;
 459   4                                              OUT25=0;
 460   4                                              OUT1=0;
 461   4                                              OUT2=0;
 462   4                                              OUT3=0;
 463   4                                              OUT6=0;
 464   4                                              OUT7=0;
 465   4                                              delay_ms(500);
 466   4                                              OUT21=1;
 467   4                                              OUT22=1;
 468   4                                              OUT23=1;
 469   4                                              OUT24=1;
 470   4                                              OUT25=1;
 471   4                                              OUT26=1;
 472   4                                              OUT1=1;
 473   4                                              OUT2=1;
 474   4                                              OUT3=1;
 475   4                                              OUT4=1;
 476   4                                              OUT5=1;
 477   4                                              OUT6=1;
 478   4                                              OUT7=1;
 479   4                                              for(i1=0;i1<150;i1++)
 480   4                                              {
 481   5                                                if(INPUT16==1)
 482   5                                                {
 483   6                                                  delay_ms(50);
 484   6                                                      if(INPUT16==1)
 485   6                                                      {
C51 COMPILER V9.05   MAIN                                                                  06/15/2016 22:42:16 PAGE 9   

 486   7                                                         count++;
 487   7                                                         OUT21=0;
 488   7                                                      }
 489   6                                                }
 490   5                                                if(INPUT15==1)
 491   5                                                {
 492   6                                                  delay_ms(50);
 493   6                                                      if(INPUT15==1)
 494   6                                                      {
 495   7                                                         count++;
 496   7                                                         OUT22=0;
 497   7                                                      }
 498   6                                                }
 499   5                                                 if(INPUT14==1)
 500   5                                                {
 501   6                                                  delay_ms(50);
 502   6                                                      if(INPUT14==1)
 503   6                                                      {
 504   7                                                         count++;
 505   7                                                         OUT23=0;
 506   7                                                      }
 507   6                                                }
 508   5                                                if(INPUT13==1)
 509   5                                                {
 510   6                                                  delay_ms(50);
 511   6                                                      if(INPUT13==1)
 512   6                                                      {
 513   7                                                         count++;
 514   7                                                         OUT24=0;
 515   7                                                      }
 516   6                                                }
 517   5                                                if(INPUT12==1)
 518   5                                                {
 519   6                                                  delay_ms(50);
 520   6                                                      if(INPUT12==1)
 521   6                                                      {
 522   7                                                         count++;
 523   7                                                         OUT25=0;
 524   7                                                      }
 525   6                                                }
 526   5                                                 if(INPUT11==1)
 527   5                                                {
 528   6                                                  delay_ms(50);
 529   6                                                      if(INPUT11==1)
 530   6                                                      {
 531   7                                                         count++;
 532   7                                                         OUT26=0;
 533   7                                                      }
 534   6                                                }
 535   5                                                delay_ms(100);
 536   5                                              }
 537   4      
 538   4                                          OUT21=0;
 539   4                                              OUT22=0;
 540   4                                              OUT23=0;
 541   4                                              OUT24=0;
 542   4                                              OUT25=0;
 543   4                                              OUT26=0;
 544   4                                              OUT1=0;
 545   4                                              OUT2=0;
 546   4                                              OUT3=0;
 547   4                                              OUT4=0;
C51 COMPILER V9.05   MAIN                                                                  06/15/2016 22:42:16 PAGE 10  

 548   4                                              OUT5=0;
 549   4                                              OUT6=0;
 550   4                                              OUT7=0;
 551   4      
 552   4                                              flag_step11=1;
 553   4                                }
 554   3                                    if(count>=10)
 555   3                                              {
 556   4                                                              delay_ms(500);
 557   4                                                                      OUT21=1;                           //打开六芒星灯带
 558   4                                                                      OUT22=1;
 559   4                                                                      OUT23=1;
 560   4                                                                      OUT24=1;
 561   4                                                                      OUT25=1;
 562   4                                                                      OUT26=1;
 563   4                                                                 delay_ms(500);
 564   4                                                                  OUT21=0;                       //关闭六芒星灯带
 565   4                                                                      OUT22=0;
 566   4                                                                      OUT23=0;
 567   4                                                                      OUT24=0;
 568   4                                                                      OUT25=0;
 569   4                                                                      OUT26=0;
 570   4                                                                      delay_ms(500);
 571   4                                                                      OUT21=1;                           //打开六芒星灯带
 572   4                                                                      OUT22=1;
 573   4                                                                      OUT23=1;
 574   4                                                                      OUT24=1;
 575   4                                                                      OUT25=1;
 576   4                                                                      OUT26=1;
 577   4                                                                 delay_ms(500);
 578   4                                                                  OUT21=0;                       //关闭六芒星灯带
 579   4                                                                      OUT22=0;
 580   4                                                                      OUT23=0;
 581   4                                                                      OUT24=0;
 582   4                                                                      OUT25=0;
 583   4                                                                      OUT26=0;
 584   4                                                         mp3(0x33);
 585   4                                                 mp3(0x0a);
 586   4                                                              delay_ms(8000);
 587   4                                                              OUT21=1;                           //打开六芒星灯带
 588   4                                                              OUT22=1;
 589   4                                                              OUT23=1;
 590   4                                                              OUT24=1;
 591   4                                                              OUT25=1;
 592   4                                                              OUT26=1;
 593   4                                                              OUT1=1;
 594   4                                                              OUT2=1;
 595   4                                                              OUT3=1;
 596   4                                                              OUT4=1;
 597   4                                                              OUT5=1;
 598   4                                                              OUT6=1;
 599   4                                                              OUT7=1;
 600   4                                                         delay_ms(8000);
 601   4                                                         delay_ms(8000);
 602   4                                                         delay_ms(8000);
 603   4                                                         delay_ms(8000);
 604   4                                                         delay_ms(8000);
 605   4                                                         delay_ms(8000);
 606   4                                                         OUT8=0;                                //开最终门
 607   4                                                         while(1);
 608   4                                              }
 609   3                                              else
C51 COMPILER V9.05   MAIN                                                                  06/15/2016 22:42:16 PAGE 11  

 610   3                                              {
 611   4                                                            mp3(0x33);
 612   4                                                    mp3(0x09);
 613   4                                                              flag_step11=0;
 614   4                                                              count=0;
 615   4      
 616   4                                                              OUT21=0;                           //打开六芒星灯带
 617   4                                                              OUT22=0;
 618   4                                                              OUT23=0;
 619   4                                                              OUT24=0;
 620   4                                                              OUT25=0;
 621   4                                                              OUT26=0;
 622   4                                                              OUT1=0;
 623   4                                                              OUT2=0;
 624   4                                                              OUT3=0;
 625   4                                                              OUT4=0;
 626   4                                                              OUT5=0;
 627   4                                                              OUT6=0;
 628   4                                                              OUT7=0;
 629   4                                                              delay_ms(8000);
 630   4                                                              delay_ms(8000);
 631   4                                              }       
 632   3                              
 633   3                         }
 634   2                                                      
 635   2                }                                                                                                       
 636   1      }
 637                                                                                                                                                                                      
 638          void sys_init()
 639          {
 640   1              P0M1=0X00;
 641   1              P0M0=0Xff;      //设置P0为推挽输出
 642   1              
 643   1              P1M1=0X00;
 644   1              P1M0=0XFF;          //设置P1为推挽输出
 645   1              
 646   1              P2M1=0X00;
 647   1              P2M0=0XFF;              //设置P2口为推挽输出
 648   1              
 649   1              P3M1=0X00;
 650   1              P3M0=0XFC;          //设置P3为推挽输出
 651   1      
 652   1              P4M1=0X00;
 653   1              P4M0=0XFF;      //设置P4为推挽输出
 654   1              
 655   1                      
 656   1              //R1-R5所有电磁锁吸合
 657   1              OUT1=0;
 658   1              OUT2=0;
 659   1              OUT3=0;
 660   1              OUT4=0;
 661   1              OUT5=0;
 662   1              OUT6=0;         //  
 663   1              OUT7=0;         //      
 664   1      
 665   1              OUT8=1;         //  最终逃生门
 666   1      
 667   1              OUT9=0;         //      
 668   1              OUT10=0;        //      
 669   1      
 670   1              
 671   1      
C51 COMPILER V9.05   MAIN                                                                  06/15/2016 22:42:16 PAGE 12  

 672   1              INPUT16=1;  // 激光接收器 *6
 673   1              INPUT15=1;      //
 674   1              INPUT14=1; 
 675   1              INPUT13=1; 
 676   1              INPUT11=1;      
 677   1              INPUT12=1;
 678   1      
 679   1              INPUT10=1;      //金属接近开关  *7
 680   1              INPUT9=1;
 681   1              INPUT8=1;
 682   1              INPUT7=1;
 683   1              INPUT6=1;
 684   1              INPUT5=1;
 685   1              OUT28=1;
 686   1              OUT29=1;
 687   1      
 688   1              OUT21=0;        //激光接收器的灯带
 689   1              OUT22=0;
 690   1              OUT23=0;
 691   1              OUT24=0;
 692   1              OUT25=0;
 693   1              OUT26=0;
 694   1              OUT27=0;
 695   1                        
 696   1              uart_init();               //串口初始化 
 697   1              mp3_init();                //MP3初始化  */
 698   1      
 699   1      }
 700          
 701          
 702          
 703          void delay_ms(int count)  // /* X1ms */
 704          {
 705   1              int i,j;
 706   1              for(i=0;i<count;i++)
 707   1                      for(j=0;j<1000;j++);
 708   1      } 
 709          
 710          
 711          
 712          /*********************************************************/
 713          /*                                                       */
 714          /* MP3操作指令                                           */
 715          /*                                                       */
 716          /*********************************************************/
 717          void mp3(unsigned char comd)
 718          {
 719   1        switch(comd)
 720   1                {
 721   2                  
 722   2                  case 0X01: send(0X7E);//指令开始位
 723   2                                         send(0X04);//说明指令长度
 724   2                                         send(0X42);//指定文件夹播放
 725   2                                         send(0X01);//定位到名称为“01”的文件夹
 726   2                                         send(0x01);//播放第1个音频文件
 727   2                                         send(0XEF);//指令结束位 
 728   2                                     break;
 729   2                      case 0X02: send(0X7E);//指令开始位
 730   2                                         send(0X04);//说明指令长度
 731   2                                         send(0X42);//指定文件夹播放
 732   2                                         send(0X01);//定位到名称为“01”的文件夹
 733   2                                         send(0x02);//播放第2个音频文件
C51 COMPILER V9.05   MAIN                                                                  06/15/2016 22:42:16 PAGE 13  

 734   2                                         send(0XEF);//指令结束位 
 735   2                                     break;
 736   2                  case 0X03: send(0X7E);//指令开始位
 737   2                                         send(0X04);//说明指令长度
 738   2                                         send(0X42);//指定文件夹播放
 739   2                                         send(0X01);//定位到名称为“01”的文件夹
 740   2                                         send(0x03);//播放第3个音频文件
 741   2                                         send(0XEF);//指令结束位 
 742   2                                     break;
 743   2                      case 0X04: send(0X7E);//指令开始位
 744   2                                         send(0X04);//说明指令长度
 745   2                                         send(0X42);//指定文件夹播放
 746   2                                         send(0X01);//定位到名称为“01”的文件夹
 747   2                                         send(0x04);//播放第4个音频文件
 748   2                                         send(0XEF);//指令结束位 
 749   2                                     break;
 750   2                      case 0X05: send(0X7E);//指令开始位
 751   2                                         send(0X04);//说明指令长度
 752   2                                         send(0X42);//指定文件夹播放
 753   2                                         send(0X01);//定位到名称为“01”的文件夹
 754   2                                         send(0x05);//播放第5个音频文件
 755   2                                         send(0XEF);//指令结束位 
 756   2                                     break;
 757   2                  case 0X06: send(0X7E);//指令开始位
 758   2                                         send(0X04);//说明指令长度
 759   2                                         send(0X42);//指定文件夹播放
 760   2                                         send(0X01);//定位到名称为“01”的文件夹
 761   2                                         send(0x06);//播放第6个音频文件
 762   2                                         send(0XEF);//指令结束位 
 763   2                                     break;
 764   2                      case 0X07: send(0X7E);//指令开始位
 765   2                                         send(0X04);//说明指令长度
 766   2                                         send(0X42);//指定文件夹播放
 767   2                                         send(0X01);//定位到名称为“01”的文件夹
 768   2                                         send(0x07);//播放第7个音频文件
 769   2                                         send(0XEF);//指令结束位 
 770   2                                     break;
 771   2                      case 0X08: send(0X7E);//指令开始位
 772   2                                         send(0X04);//说明指令长度
 773   2                                         send(0X42);//指定文件夹播放
 774   2                                         send(0X01);//定位到名称为“01”的文件夹
 775   2                                         send(0x08);//播放第8个音频文件
 776   2                                         send(0XEF);//指令结束位 
 777   2                                     break;
 778   2                  case 0X09: send(0X7E);//指令开始位
 779   2                                         send(0X04);//说明指令长度
 780   2                                         send(0X42);//指定文件夹播放
 781   2                                         send(0X01);//定位到名称为“01”的文件夹
 782   2                                         send(0x09);//播放第9个音频文件
 783   2                                         send(0XEF);//指令结束位 
 784   2                                     break;
 785   2                      case 0X0A: send(0X7E);//指令开始位
 786   2                                         send(0X04);//说明指令长度
 787   2                                         send(0X42);//指定文件夹播放
 788   2                                         send(0X01);//定位到名称为“01”的文件夹
 789   2                                         send(0x0A);//播放第10个音频文件
 790   2                                         send(0XEF);//指令结束位 
 791   2                                     break;
 792   2                      case 0X0B: send(0X7E);//指令开始位
 793   2                                         send(0X04);//说明指令长度
 794   2                                         send(0X42);//指定文件夹播放
 795   2                                         send(0X01);//定位到名称为“01”的文件夹
C51 COMPILER V9.05   MAIN                                                                  06/15/2016 22:42:16 PAGE 14  

 796   2                                         send(0x0B);//播放第11个音频文件
 797   2                                         send(0XEF);//指令结束位 
 798   2                                     break;
 799   2                  case 0X0C: send(0X7E);//指令开始位
 800   2                                         send(0X04);//说明指令长度
 801   2                                         send(0X42);//指定文件夹播放
 802   2                                         send(0X01);//定位到名称为“01”的文件夹
 803   2                                         send(0x0C);//播放第12个音频文件
 804   2                                         send(0XEF);//指令结束位 
 805   2                                     break;
 806   2                      case 0X0D: send(0X7E);//指令开始位
 807   2                                         send(0X04);//说明指令长度
 808   2                                         send(0X42);//指定文件夹播放
 809   2                                         send(0X01);//定位到名称为“01”的文件夹
 810   2                                         send(0x0D);//播放第13个音频文件
 811   2                                         send(0XEF);//指令结束位 
 812   2                                     break;
 813   2                      case 0X0E: send(0X7E);//指令开始位
 814   2                                         send(0X04);//说明指令长度
 815   2                                         send(0X42);//指定文件夹播放
 816   2                                         send(0X01);//定位到名称为“01”的文件夹
 817   2                                         send(0x0E);//播放第14个音频文件
 818   2                                         send(0XEF);//指令结束位 
 819   2                                     break;
 820   2                  case 0X0F: send(0X7E);//指令开始位
 821   2                                         send(0X04);//说明指令长度
 822   2                                         send(0X42);//指定文件夹播放
 823   2                                         send(0X01);//定位到名称为“01”的文件夹
 824   2                                         send(0x0F);//播放第15个音频文件
 825   2                                         send(0XEF);//指令结束位 
 826   2                                     break;
 827   2      
 828   2                      case 0X31: send(0X7E);//指令开始位
 829   2                                         send(0X03);//说明指令长度
 830   2                                         send(0X31);//设置音量
 831   2                                         send(0X20);//20
 832   2                                         send(0XEF);//指令结束位 
 833   2                                     break;
 834   2                      case 0X32: send(0X7E);//指令开始位
 835   2                                         send(0X03);//说明指令长度
 836   2                                         send(0X31);//设置音量
 837   2                                         send(0X10);//20
 838   2                                         send(0XEF);//指令结束位 
 839   2                                     break;
 840   2      
 841   2                      case 0X33: send(0X7E);//指令开始位
 842   2                                         send(0X03);//说明指令长度
 843   2                                         send(0X33);//设置循环模式
 844   2                                         send(0X04);//单曲播放
 845   2                                         send(0XEF);//指令结束位 
 846   2                                     break;
 847   2                      
 848   2                      case 0X34: send(0X7E);//指令开始位
 849   2                                         send(0X03);//说明指令长度
 850   2                                         send(0X33);//设置循环模式
 851   2                                         send(0X02);//单曲循环！
 852   2                                         send(0XEF);//指令结束位 
 853   2                                     break;
 854   2                      case 0X35: send(0X7E);//指令开始位
 855   2                                         send(0X03);//说明指令长度
 856   2                                         send(0X31);//设置音量
 857   2                                         send(0X07);//20
C51 COMPILER V9.05   MAIN                                                                  06/15/2016 22:42:16 PAGE 15  

 858   2                                         send(0XEF);//指令结束位 
 859   2                                     break;
 860   2                      case 0X36: send(0X7E);//指令开始位
 861   2                                         send(0X03);//说明指令长度
 862   2                                         send(0X31);//设置音量
 863   2                                         send(0X10);//20
 864   2                                         send(0XEF);//指令结束位 
 865   2                                     break;
 866   2                }
 867   1        
 868   1      }
 869          /*********************************************************/
 870          /*                                                       */
 871          /* MP3初始化                                             */
 872          /*                                                       */
 873          /*********************************************************/
 874          void mp3_init()
 875          {
 876   1        mp3(0x33);                 //设置循环模式为文件夹循环
 877   1        mp3(0x31);                 //设置音量为20
 878   1        //mp3(0x00);                 //开机播放
 879   1      
 880   1        /*不关闭串行中断的话一上电就会发送STOP，这样会影响曲名和播放歌曲的对应关系*/
 881   1        ES=0;                                    //串行中断禁止
 882   1        delay_ms(100);                           //等待MP3准备好
 883   1        ES=1;
 884   1      }
 885          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1887    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     28    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
